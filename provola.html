<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demo Movies</title>
<style>
body { font-family: Arial, sans-serif; background:#141414; color:#fff; margin:0; padding:20px; }
h1 { text-align:center; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; }
.card { cursor:pointer; border-radius:12px; overflow:hidden; border:2px solid #444; background:#1f1f1f; transition: transform 0.2s; }
.card:hover { transform: scale(1.05); border-color:#e50914; }
.poster { width:100%; display:block; }
#playerOverlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center; z-index:1000; }
#playerOverlay iframe { width:100%; height:100%; border:none; }
#detailPage { display:none; padding:20px; background:#141414; }
button { cursor:pointer; }
</style>
</head>
<body>

<h1>Movies & Series</h1>
<div id="moviesGrid" class="grid"></div>

<div id="playerOverlay">
  <iframe allow="autoplay; fullscreen; encrypted-media" allowfullscreen></iframe>
</div>

<script>
// dati fittizi
const allData = [
  {id:1,title:"Film 1",poster:"https://via.placeholder.com/150x220?text=Film+1",genres:["Azione"],vote:8.2,overview:"Trama del Film 1",year:"2023",duration:120,cast:["Attore A","Attore B"],type:"movie",link:"https://example.com/movie1"},
  {id:2,title:"Serie 1",poster:"https://via.placeholder.com/150x220?text=Serie+1",genres:["Commedia"],vote:7.5,overview:"Trama della Serie 1",year:"2022",duration:45,cast:["Attore C","Attore D"],type:"tv",seasons:3,episodes:{1:10,2:8,3:12},link:""}
];
let currentItem = null;

// griglia
const grid = document.getElementById('moviesGrid');
const overlay = document.getElementById('playerOverlay');
const iframe = overlay.querySelector('iframe');

// dettaglio full-page
let detailPage = document.createElement('div');
detailPage.id = 'detailPage';
detailPage.innerHTML = `
  <button id="backToGrid">← Torna alla griglia</button>
  <h2 id="detailTitle"></h2>
  <img id="detailPoster" style="max-width:300px;display:block;margin:10px 0;">
  <p id="detailGenres"></p>
  <p id="detailVote"></p>
  <p id="detailOverview"></p>
  <p id="detailYear"></p>
  <p id="detailDuration"></p>
  <p id="detailCast"></p>
  <select id="detailSeason" style="display:none;margin:5px;"></select>
  <select id="detailEpisode" style="display:none;margin:5px;"></select>
  <button id="detailPlayBtn">Riproduci</button>
`;
document.body.appendChild(detailPage);

const detailTitle = document.getElementById('detailTitle');
const detailPoster = document.getElementById('detailPoster');
const detailGenres = document.getElementById('detailGenres');
const detailVote = document.getElementById('detailVote');
const detailOverview = document.getElementById('detailOverview');
const detailYear = document.getElementById('detailYear');
const detailDuration = document.getElementById('detailDuration');
const detailCast = document.getElementById('detailCast');
const detailSeason = document.getElementById('detailSeason');
const detailEpisode = document.getElementById('detailEpisode');
const detailPlayBtn = document.getElementById('detailPlayBtn');
const backToGrid = document.getElementById('backToGrid');

function openDetail(item,push=true){
  currentItem = item;
  grid.style.display = 'none';
  detailPage.style.display = 'block';
  detailTitle.textContent = item.title;
  detailPoster.src = item.poster;
  detailGenres.textContent = "Generi: "+item.genres.join(", ");
  detailVote.textContent = "★ "+item.vote;
  detailOverview.textContent = item.overview;
  detailYear.textContent = "Anno: "+item.year;
  detailDuration.textContent = "Durata: "+item.duration+" min";
  detailCast.textContent = "Cast: "+item.cast.join(", ");
  
  detailSeason.style.display='none';
  detailEpisode.style.display='none';
  if(item.type==='tv'){
    detailSeason.style.display='inline';
    detailEpisode.style.display='inline';
    detailSeason.innerHTML='';
    for(let s=1;s<=item.seasons;s++){
      let o = document.createElement('option');
      o.value=s; o.textContent="Stagione "+s;
      detailSeason.appendChild(o);
    }
    updateEpisodes();
    detailSeason.onchange=updateEpisodes;
    function updateEpisodes(){
      let season=parseInt(detailSeason.value);
      let epCount = item.episodes[season];
      detailEpisode.innerHTML='';
      for(let e=1;e<=epCount;e++){
        let o = document.createElement('option');
        o.value=e; o.textContent="Episodio "+e;
        detailEpisode.appendChild(o);
      }
    }
  }

  detailPlayBtn.onclick = () => openPlayer(item);

  if(push) history.pushState({page:"detail",itemId:item.id},"","#detail-"+item.id);
}

function openPlayer(item,push=true){
  let link = item.link;
  if(item.type==='tv'){
    let season = parseInt(detailSeason.value)||1;
    let episode = parseInt(detailEpisode.value)||1;
    link = `https://example.com/tv/${item.id}/${season}/${episode}`;
  }
  overlay.style.display='flex';
  iframe.src = link;
  if(overlay.requestFullscreen) overlay.requestFullscreen();
  if(push) history.pushState({page:"player",itemId:item.id},"","#player-"+item.id);
}

function closePlayer(){
  overlay.style.display='none';
  iframe.src='';
}

backToGrid.onclick = () => {
  history.pushState({page:"grid"},"","#grid");
  detailPage.style.display='none';
  grid.style.display='grid';
}

window.addEventListener("popstate", function(e){
  const state=e.state;
  if(!state||state.page==="grid"){
    closePlayer();
    detailPage.style.display='none';
    grid.style.display='grid';
    return;
  }
  const itemId = state.itemId;
  const item = allData.find(x=>x.id===itemId);
  if(!item){ closePlayer(); detailPage.style.display='none'; grid.style.display='grid'; return; }
  if(state.page==="player"){ openPlayer(item,false); }
  else if(state.page==="detail"){ closePlayer(); openDetail(item,false); }
});

function render(){
  grid.innerHTML='';
  allData.forEach(item=>{
    let card=document.createElement('div');
    card.className='card';
    card.innerHTML=`<img class='poster' src='${item.poster}'><p>${item.title}</p>`;
    card.onclick = ()=>openDetail(item);
    grid.appendChild(card);
  });
}

render();
</script>
</body>
</html>
